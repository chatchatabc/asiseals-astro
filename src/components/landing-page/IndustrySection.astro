---
import industriesJson from "@data/industries.json";
import { Icon } from "astro-icon";
---

<industry-section>
  <!-- Header -->
  <header
    class="flex justify-between items-center max-w-7xl mx-auto px-4 lg:px-8"
  >
    <h1 class="text-5xl">Industry</h1>
    <div class="flex items-center divide-x">
      <button id="prev-btn" class="px-2">
        <Icon
          name="mdi:chevron-left"
          class="h-8 w-8 transition hover:text-primary"
        />
      </button>
      <button id="next-btn" class="px-2">
        <Icon
          name="mdi:chevron-right"
          class="h-8 w-8 transition hover:text-primary"
        />
      </button>
    </div>
  </header>

  <!-- Container -->
  <section class="max-w-7xl mx-auto px-4 mt-6">
    <!-- Carousel -->
    <section id="carousel" class="flex overflow-x-hidden snap-x pb-16">
      {
        industriesJson.contents.map((item) => {
          return (
            <div class="snap-start flex-shrink-0 p-4 w-full md:w-1/3 lg:w-1/4">
              <figure class="relative group">
                <div class="bg-white py-16 w-full h-56 px-8">
                  <a
                    href={`/industries/${item.slug}`}
                    class="duration-500 relative h-full block z-[1] group-hover:opacity-0"
                  >
                    <img
                      src={item.image}
                      alt={item.name}
                      class="w-full h-full object-contain"
                    />
                  </a>
                </div>
                <figcaption class="duration-500 absolute w-full h-fit left-0 bottom-0 translate-y-full group-hover:bottom-1/2 group-hover:translate-y-1/2">
                  <p class="text-center duration-500 text-xl tracking-widest px-8 group-hover:tracking-[0.5rem]">
                    <span class="transition group-hover:text-primary">
                      {item.name}
                    </span>
                  </p>
                </figcaption>
              </figure>
            </div>
          );
        })
      }
    </section>
  </section>

  <!-- Action button -->
  <a
    href="/industries"
    class="block w-fit py-4 px-6 mx-auto text-xl bg-primary"
  >
    View More Industries &gt;
  </a>
</industry-section>

<script>
  class IndustrySection extends HTMLElement {
    constructor() {
      super();

      const carousel = this.querySelector<HTMLElement>("#carousel")!;
      const nextBtn = this.querySelector("#next-btn");
      const prevBtn = this.querySelector("#prev-btn");

      let interval: any;

      nextBtn?.addEventListener("click", () => {
        moveFirstChildToLast();
        nextSlide();
        resetInterval();
      });

      prevBtn?.addEventListener("click", () => {
        moveFirstChildToLast(false);
        nextSlide(false);
        resetInterval();
      });

      function resetInterval() {
        if (interval) {
          clearInterval(interval);
        }

        interval = setInterval(() => {
          moveFirstChildToLast();
          nextSlide();
        }, 4000);
      }

      function nextSlide(next: boolean = true) {
        const move = next ? 300 : -300;
        carousel.scrollBy({
          left: move,
          behavior: "smooth",
        });
      }

      function moveFirstChildToLast(move: boolean = true) {
        if (move) {
          const firstChild = carousel.firstElementChild;
          const clone = firstChild?.cloneNode(true);
          if (clone) {
            carousel.appendChild(clone!);
            carousel.removeChild(firstChild!);
          }
        } else {
          const lastChild = carousel.lastElementChild;
          const clone = lastChild?.cloneNode(true);
          if (clone) {
            carousel.insertBefore(clone, carousel.firstElementChild);
            carousel.removeChild(lastChild!);
          }
        }
      }

      resetInterval();
      nextSlide();
    }
  }

  customElements.define("industry-section", IndustrySection);
</script>
