---
import ContactUsForm from "@components/widgets/ContactUsForm.astro";
import LayoutCategory from "@layouts/LayoutCategory.astro";
import { utilRemoveLastSlash } from "src/helpers/commonUtils";
import productsJson from "@data/products.json";
import { Img, Picture } from "astro-imagetools/components";

export function getStaticPaths() {
  return productsJson.contents.map((product) => {
    return {
      params: {
        subCategory: product.subCategory,
        category: product.category,
        product: product.slug,
      },
    };
  });
}

const { pathname } = Astro.url;

const processedPathname = utilRemoveLastSlash(pathname);
const splitPathname = processedPathname.split("/");
const slug = splitPathname[splitPathname.length - 2];

const product = productsJson.contents.find((product) => {
  return product.slug === slug;
});
---

<LayoutCategory
  image="/images/products/banner-inner.webp"
  pageTitle={product?.pageTitle ?? product?.name}
  pageDescription={product?.pageDescription ?? product?.summary}
  pageKeywords={product?.pageKeywords}
  ogImage={product?.ogImage ?? product?.imageUrl}
  ogTitle={product?.ogTitle ?? product?.name ?? product?.pageTitle}
  ogDescription={product?.ogDescription ??
    product?.pageDescription ??
    product?.summary}
  ogType={product?.ogType}
  twitterCardType={product?.twitterCardType}
  twitterTitle={product?.twitterTitle}
  twitterDescription={product?.twitterDescription}
  twitterImage={product?.twitterImage}
>
  <div slot="banner">
    <div class="w-32 mx-auto">
      <Picture
        preload={"webp"}
        breakpoints={[320]}
        src="/images/logo/icon.png"
        alt="icon"
      />
    </div>
    <h1 class="text-4xl text-white text-center italic mt-4">
      Professional Design. Efficient. Durable
    </h1>
  </div>
  <section class="max-w-7xl mx-auto my-8 px-4 lg:px-8">
    <header>
      <h2 class="text-4xl">Contact Us</h2>
    </header>

    <!-- Product Info -->
    <section class="my-4 border">
      <table class="w-full text-left text-xl">
        <thead>
          <tr class="bg-gray-100">
            <th class="p-2 border-r">Product Picture</th>
            <th class="p-2">Product Name</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td class="w-1/2 border-r p-2">
              <div class="w-1/2 mx-auto">
                <Img src={product?.imageUrl} alt={product?.name} />
              </div>
            </td>
            <td class="w-1/2 p-2">{product?.name}</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- Contact Us Form -->
    <section>
      <ContactUsForm slug={slug} />
    </section>
  </section>
</LayoutCategory>
